<head>
	<link rel="stylesheet" href="styles.css">
</head>
<body>
	<div class = "maindiv">
		<div class="title">РЖД МАРКЕТ <img class = "mimg" src = "images/market.png"/> </div>
		<div class="flexboxes"  id = "flexbox"> </div>
	</div>
	<div class="block" id = "adam" hidden>
		<img class="imgres" src = "images/coke.png" alt=""/>
		<div class="goodName"> Газировка</div>
		<button class="goodButton" id="price">100₽</button>
			
	</div>
	<div class = "buttonblock">
		<button id = "buyButton">Корзина 0.00 ₽</button>
	</div>
	<script src="https://telegram.org/js/telegram-web-app.js"></script>
	<script>
		function updateElem(element, name, price, imageName)
		{
			var children = element.children;
			for(var i=0; i<children.length; i++)
			{
				var child = children[i];
				if (child.classList[0] == 'goodButton')
				{
					child.textContent=price;
					child.addEventListener("click", () => 
					{
						let ls = window.localStorage.getItem("sum");
						let pp = child.textContent.substring(0, child.textContent.length - 1);
						window.localStorage.setItem("sum", parseInt(ls)+parseInt(pp));
						ls = parseInt(ls)+parseInt(pp);
						let buyButton = document.getElementById("buyButton");
						buyButton.textContent = "Корзина " + ls  + '.00₽';
					});
				}
				if (child.classList[0] == 'imgres')
					child.src  = "images/" + imageName;
				if (child.classList[0] == 'goodName')
					child.textContent=name;
			}
		}
		window.localStorage.setItem("sum", '0')
		//Заглушечка
		let arrayPhotos = ["Завтрак в вагоне СВ.jpg", 
		"Обед в купейном вагоне (детский).jpg", "Ужин в купейном вагоне (вегетарианский).jpg",
		 "Сэндвич с сыром.jpg", "Салат из свежих овощей.jpg", "coke.png"];
		let prices = ["500₽", "100₽", "500₽", "400₽", "600₽", "100₽", "250₽", "100₽", "350₽", "250₽", "550₽"];
		let names = ["Завтрак Взрослый",  "Детский обед", "Ужин (вег.)", "Сэндвич с сыром", "Обед витаминный", "Газировка"];
		let box = document.getElementById("flexbox");
		let element = document.getElementById("adam");
		//element.innerHTML = '';
		for (let i = 0; i < 6; i++) 
		{
			let new_element = element.cloneNode(true);
			new_element.removeAttribute("hidden");
			updateElem(new_element, names[i], prices[i], arrayPhotos[i]);
			box.appendChild(new_element);
		}
		
	</script>
	<script>
		let tg = window.Telegram.WebApp;
		//let userId = th.initDataUnsafe.user.id;

		let buyButton = document.getElementById("buyButton");

		buyButton.addEventListener("click", () => 
		{
			let data = {
				type: "market"
			}
			tg.sendData(JSON.stringify(data));

			tg.close();
		});
	</script>
</body>